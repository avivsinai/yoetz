name: chatgpt
# Requires: yoetz browser sync-cookies (extracts cookies from Chrome)
# Verifies auth with: yoetz browser check
#
# Uses Oracle-style cookie injection + stealth flags to bypass Cloudflare.
# Model selection ensures we use GPT-5.2 Pro regardless of last-used model.

steps:
  # Open ChatGPT
  - action: open
    args: ["https://chatgpt.com/"]
  - sleep_ms: 3000

  # Select Pro model (don't rely on last-used model)
  - action: find
    args: ["label", "Model selector", "click"]
  - sleep_ms: 1000
  - action: find
    args: ["testid", "model-switcher-gpt-5-2-pro", "click"]
  - sleep_ms: 500

  # Disable extended thinking for faster responses
  # Only click if extended thinking is currently enabled (aria-label contains "remove")
  - action: eval
    args: ["document.querySelector('button[aria-label*=\"remove\"][aria-label*=\"Extended thinking\"]')?.click()"]
  - sleep_ms: 500

  # Fill the prompt using ProseMirror editor selector
  - action: fill
    args: ["#prompt-textarea", "{{bundle_text}}"]
  - sleep_ms: 500

  # Send the message
  - action: find
    args: ["label", "Send prompt", "click"]

  # Wait for response (without extended thinking, should be faster)
  - sleep_ms: 45000

  # Capture final state
  - action: snapshot
    args: ["-c", "--json"]
