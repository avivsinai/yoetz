name: chatgpt
# Requires: yoetz browser sync-cookies (extracts cookies from Chrome)
# Verifies auth with: yoetz browser check
#
# Uses Oracle-style cookie injection + stealth flags to bypass Cloudflare.
# Model selection ensures we use GPT-5.2 Pro regardless of last-used model.

steps:
  # Open ChatGPT
  - action: open
    args: ["https://chatgpt.com/"]
  - sleep_ms: 3000

  # Select Pro model (don't rely on last-used model)
  - action: find
    args: ["label", "Model selector", "click"]
  - sleep_ms: 1000
  - action: find
    args: ["testid", "model-switcher-gpt-5-2-pro", "click"]
  - sleep_ms: 500

  # Disable extended thinking for faster responses
  # Only click if extended thinking is currently enabled (aria-label contains "remove")
  - action: eval
    args: ["document.querySelector('button[aria-label*=\"remove\"][aria-label*=\"Extended thinking\"]')?.click()"]
  - sleep_ms: 500

  # Attach the bundle as a file (handles large codebases that exceed paste limits)
  - action: upload
    args: ["input[type=file]:not([id])", "{{bundle_path}}"]
  - sleep_ms: 2000

  # Add a short prompt referencing the attachment
  - action: fill
    args: ["#prompt-textarea", "Review the attached file and provide your analysis."]
  - sleep_ms: 500

  # Send the message
  - action: find
    args: ["label", "Send prompt", "click"]

  # Wait for response (file analysis may take longer with extended thinking)
  - sleep_ms: 60000

  # Capture final state
  - action: snapshot
    args: ["-c", "--json"]
